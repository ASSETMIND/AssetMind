# API-AUTH-LOCAL-FLOW-001
회원가입 / 로그인 API 흐름 정의 (Local Login)

| 문서 ID | API-AUTH-LOCAL-FLOW-001 |
|:------|:------------------------|
| 문서 버전 | 1.0                     |
| 프로젝트 | AssetMind               |
| 작성자 | 김광래                     |
| 작성일 | 2026년 1월 7일             |

---

## 1. 회원가입(Signup) API 흐름

### 정상 흐름

1. 클라이언트가 회원가입 요청을 전송한다.
2. 서버는 이메일 중복 여부를 검증한다.
3. 비밀번호 정책을 검증한다.
4. 비밀번호를 단방향 암호화한다.
5. User 엔티티를 생성한다.
6. 기본 권한(Role)을 할당한다.
7. 회원가입 성공 응답을 반환한다.

회원가입 과정에서는 토큰을 발급하지 않는다.

---

### 실패 흐름

- 이메일이 이미 존재하는 경우 회원가입에 실패한다.
- 비밀번호 정책을 만족하지 못하는 경우 회원가입에 실패한다.
- 사용자 저장 중 오류가 발생한 경우 회원가입에 실패한다.

---

## 2. 로그인(Login) API 흐름

### 정상 흐름

1. 클라이언트가 로그인 요청을 전송한다.
2. 서버는 이메일 존재 여부를 검증한다.
3. 저장된 비밀번호와 요청 비밀번호를 비교한다.
4. 인증이 성공하면 Access Token을 생성한다.
5. Refresh Token을 생성하거나 기존 토큰을 폐기 후 재발급한다.
6. Refresh Token을 서버에 저장한다.
7. Access Token과 Refresh Token을 응답으로 반환한다.

---

### 실패 흐름

- 이메일이 존재하지 않는 경우 로그인에 실패한다.
- 비밀번호가 일치하지 않는 경우 로그인에 실패한다.
- 사용자 상태가 비활성인 경우 로그인에 실패한다.

---

## 3. 토큰 처리 기준

- Access Token은 로그인 성공 시 발급한다.
- Refresh Token은 로그인 성공 시 발급한다.
- Refresh Token은 서버에서 사용자 기준으로 관리한다.
- 재로그인 시 기존 Refresh Token은 무효화된다.

---

## 4. 책임 분리 기준

### Controller
- 요청 수신 및 응답 반환
- 인증 결과 전달

### Application(Service)
- 회원가입 및 로그인 흐름 제어
- 토큰 발급 시점 제어

### Domain
- 사용자 및 토큰 생성 규칙
- 비즈니스 제약 조건 관리

### Security
- 토큰 생성
- 토큰 검증
- 인증 정보 처리