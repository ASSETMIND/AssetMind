# 거시경제 데이터 수집 파이프라인 기술 선정

| 문서 ID       | ADR-PIPE-001     |
| :------------ | :--------------- |
| **문서 버전** | 1.0              |
| **프로젝트**  | AssetMind        |
| **작성자**    | 김준수           |
| **작성일**    | 2026년 01월 06일 |

## 1. 배경 및 맥락 (Context)

본 프로젝트는 1단계(Release 1)에서 '투자 정보 제공 대시보드'를 구축하고, 2단계(Release 2)에서 '트레이딩 봇'을 개발하는 것을 목표로 한다. 이를 위해 주식, 채권, 환율, 원자재, 암호화폐 등 다양한 자산군의 **일봉(Daily Close)** 데이터를 매일 수집하고 적재하는 파이프라인이 필요하다.

**주요 제약 사항 및 요구사항:**

1.  **비용 효율성:** 무료이면서도 공식적인(Official) API를 사용해야 한다. (웹 크롤링 배제)
2.  **안정성:** Airflow를 이용한 배치 작업 시, API 변경이나 차단으로 인한 파이프라인 중단(Failure)이 없어야 한다.
3.  **확장성:** 추후 자산군이 추가되거나 트레이딩 모델(Release 2) 도입 시 데이터 구조 변경을 최소화해야 한다.
4.  **현물 vs 선물 이슈:** 트레이딩(Release 2)을 위해서는 선물(Futures) 데이터가 이상적이나, 무료 선물 데이터는 월물 교체(Rollover) 및 연결(Back-adjustment) 처리가 어렵고 데이터 품질이 낮다는 문제가 식별되었다.

## 2. 결정 사항 (Decision)

우리는 데이터의 **신뢰성(Reliability)**과 **유지보수 용이성(Maintainability)**을 최우선 가치로 두어, 다음과 같은 **하이브리드 데이터 수집 전략**을 채택한다.

### 2.1. 자산군별 수집 원천 (Source of Truth) 확정

| 자산군          | 세부 항목                | 선정 API               | 결정 근거                                               |
| :-------------- | :----------------------- | :--------------------- | :------------------------------------------------------ |
| **주식 (지수)** | KOSPI, NASDAQ, S&P 500   | **한국투자증권 (KIS)** | 국내/해외 주식 통합 관리, OAuth 2.0 인증 구현 역량 확보 |
| **환율**        | USD/KRW, 달러 인덱스     | **FRED** (Fed)         | 거시경제 데이터의 글로벌 표준. KIS 대비 접근성 우수     |
| **채권 (미국)** | US Treasury (2,5,10,30Y) | **FRED** (Fed)         | 환율 데이터와 소스 통일, 미국 연준 공식 데이터          |
| **채권 (한국)** | 국고채 (3,5,10,30Y)      | **ECOS** (한국은행)    | 한국 중앙은행 공식 통계로 데이터 정합성 최상            |
| **원자재 A**    | 금, 은, 유가, 천연가스   | **FRED** (Spot Price)  | 선물 롤오버 리스크 제거, 데이터 연속성 보장 (현물)      |
| **원자재 B**    | 구리, 밀                 | **Nasdaq Data Link**   | FRED 일봉 부재에 따른 대안. 연결 선물(Continuous) 활용  |
| **암호화폐**    | BTC, ETH                 | **Upbit**              | 국내 거래량 1위, API Rate Limit 안정성 우수             |

### 2.2. 현물(Spot) 중심 수집 및 단계적 확장 전략

- **전략:** Release 1 단계에서는 원자재 데이터를 **현물(Spot)** 위주로 수집한다.
- **근거:**
  - 무료 선물 데이터의 품질 이슈(데이터 누락, 연결 불량)로 인한 파이프라인 불안정성을 사전에 차단한다.
  - 주가 예측 모델링(Release 2) 시, 현물 가격은 선물 가격과 장기적 상관관계(Correlation > 0.9)가 높아 피쳐(Feature)로서 충분한 가치를 가진다.
  - 추후 고도화 필요시 별도의 선물 데이터 파이프라인을 '추가'하는 방식(Scale-out)이 아키텍처 관점에서 유리하다.

## 3. 상세 기술 구현 지침 (Technical Guidelines)

본 결정에 따라 개발 시 다음 사항을 준수해야 한다.

1.  **KIS 인증 토큰 관리:** 한국투자증권 Access Token은 유효기간이 존재하므로, `TokenManager` 모듈을 별도 구현하여 만료 시 자동 갱신(Refresh) 되도록 한다.
2.  **시차(Timezone) 처리:** 한국(KST)과 미국(EST/EDT)의 장 마감 시간이 다르므로, 모든 DB 적재 시간은 **UTC** 또는 **KST(YYYY-MM-DD)** 기준으로 명확히 통일한다. 데이터가 없는 날(휴장일 등)에 대한 Null 처리 정책을 수립한다.
3.  **데이터 정합성 (Idempotency):** Airflow 재실행(Retry) 시 데이터 중복을 방지하기 위해 `Upsert` (Insert on Conflict Update) 로직을 적용한다.
4.  **확장성 고려:** FRED와 ECOS 수집기는 `Series ID` 리스트를 설정 파일(Config)로 관리하여, 코드 수정 없이 수집 대상을 늘릴 수 있도록 설계한다.

## 4. 결과 (Consequences)

이 결정을 통해 얻게 되는 이득(Pros)과 감수해야 할 비용(Cons)은 다음과 같다.

### 긍정적 효과 (Pros)

- **엔터프라이즈급 신뢰성:** 각 국가의 중앙은행(Fed, BOK) 및 1위 거래소 데이터를 사용하여 데이터 오류 가능성을 최소화했다.
- **개발 생산성 향상:** 복잡한 선물 롤오버(Rollover) 로직을 구현할 필요가 없어, 파이프라인 구축 및 대시보드 시각화에 집중할 수 있다.
- **포트폴리오 차별화:** 단순 라이브러리(yfinance 등) 의존을 탈피하고, 도메인 특성에 맞춘 다중 API(Multi-source) 통합 아키텍처를 설계했음을 증명할 수 있다.

### 부정적 효과 및 대응 (Cons & Mitigation)

- **구현 복잡도 증가:** 단일 라이브러리를 쓰는 것보다 인증 처리(OAuth, API Key) 및 데이터 파싱(JSON, XML) 공수가 증가한다.
  - _대응:_ 이를 데이터 엔지니어링 역량을 보여주는 기회로 활용한다.
- **데이터 지연(Latency):** Nasdaq Data Link 등 무료 티어 API는 실시간 대비 1일 정도 지연될 수 있다.
  - _대응:_ 프로젝트 목표가 '종가 기준 분석'이므로 수용 가능한 범위임을 확인했다.
